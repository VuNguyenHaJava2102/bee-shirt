<app-main-heading [icon]="'fa-solid fa-shirt'" [mainHeading]="'Phiếu Giảm Giá'"
  [title]="'Phiếu Giảm Giá'"></app-main-heading>
<!-- Row start -->

<div class="row gutters">
  <div class="col-sm-12">


    <div class="card">
      <div class="card-header">Phiếu giảm giá</div>


      <div class="card-body">

        <div class="row">
          <div class="col-md-6">
            <input type="text" name="" class="form-control rounded"
              placeholder="Tìm phiếu giảm giá theo mã hoặc theo tên" (input)="searchPhieuGiamGia($event)">
          </div>
          <div class="col-md-6 d-flex justify-content-end">
            <button class="btn btn-primary rounded" routerLink="/phieu-giam-gia/them-phieu">Tạo Mới</button>
          </div>
        </div>

        <div class="row pt-3 pb-3">
          <div class="col-md-2">
            <input type="Date" name="" class="form-control rounded" placeholder="Từ ngày" [(ngModel)]="thoiGianBatDau"  (change)="filterPrivate()">
          </div>
          <div class="col-md-2">
            <input type="Date" name="" class="form-control rounded" placeholder="Đến ngày" [(ngModel)]="thoiGianKetThuc"  (change)="filterPrivate()">
          </div>
        
          <div class="col-md-2">
            <div>
              <select class="form-control"  [(ngModel)]="loai" (change)="filterPrivate()">
                <option [ngValue]="[0,1]">Tất Cả</option>
                <option [ngValue]="[1]">Công Khai</option>
                <option [ngValue]="[0]">Cá Nhân</option>
              </select>
            </div>
          </div>
        
          <div class="col-md-2">
            <div>
              <select class="form-control"  [(ngModel)]="kieu" (change)="filterPrivate()">
                <option [ngValue]="[0,1]">Tất Cả</option>
                <option [ngValue]="[0]">%</option>
                <option [ngValue]="[1]">Tiền Mặt</option>
              </select>
            </div>
          </div>
        
          <div class="col-md-2">
            <div>
              <select class="form-control" [(ngModel)]="trangThai" (change)="filterPrivate()">
                <option [ngValue]="['Đang diễn ra','Sắp diễn ra','Đã kết thúc']">Tất Cả</option>
                <option value="Sắp diễn ra">Sắp diễn ra</option>
                <option value="Đang diễn ra">Đang diễn ra</option>
                <option value="Đã kết thúc">Đã kết thúc</option>
              </select>
            </div>
          </div>
        
          <!-- Thêm nút xóa bộ lọc -->
          <div class="col-md-2">
            <button class="btn btn-primary" (click)="clearFilters()">Xóa bộ lọc</button>
          </div>
        
        </div>

        <!-- table -->

        <!-- TABLE -->
        <table class="table">
          <thead class="thead-default">
            <tr>
              <th>STT</th>
              <th>Mã</th>
              <th>Tên</th>
              <th>Kiểu</th>
              <th>Loại</th>
              <th>Giá Trị </th>
              <th>Giá Trị Tối Đa </th>
              <th>Số Lượng</th>
              <th>Điều Kiện </th>
              <th>Ngày Bắt Đầu</th>
              <th>Ngày Kết Thúc</th>
              <th>Trạng Thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pgg of pagedResponseBinh?.data; let i = index">
              <th scope="row">{{ (i + 1) * pagedResponseBinh.pageNumber }}</th>
              <td>{{ pgg.maPhieuGiamGia }}</td>
              <td>{{ pgg.tenPhieuGiamGia }}</td>
              <td>{{ pgg.kieu == 0?"%":"Tiền Mặt" }}</td>
              <td>{{ pgg.loai == 1?"Công Khai":"Cá Nhân" }}</td>
              <td>{{ pgg.giaTri }}</td>
              <td>{{ pgg.giaTriMax | number}}VND</td>
              <td>{{ pgg.soLuong }}</td>
              <td>{{ pgg.dieuKienGiam | number}}VND</td>
              <td>{{ pgg.thoiGianBatDau | date:"dd-MM-yyyy HH:mm:ss" }}</td>
              <td>{{ pgg.thoiGianKetThuc | date:"dd-MM-yyyy HH:mm:ss" }}</td>
              <td>
                <div [ngStyle]="{
                    'padding': '10px',
                    'border-radius': '30px',
                    'color': 'white',
                    'background-color': getColorByStatus(pgg.trangThai)
                }">
                  {{ pgg.trangThai }}
                </div>
              </td>
              <td>
                <button class="btn btn-outline-light btn-rounded" id="button" data-toggle="modal"
                  data-target="#formDetailButton" data-whatever="@mdo" (click)="openDetailsForm(pgg.id)">
                  <i class="fa-solid fa-circle-info fa-xl" id="icon-button-detail"></i>
                </button>
                <button class="btn btn-outline-warning btn-rounded" title="Cập nhật"
                  routerLink="/phieu-giam-gia/sua-phieu/{{pgg.id}}">
                  <i class="fa-solid fa-pen-to-square" style="color: #ffd43b"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <!--  -->

        <!--End table-->

        <div class="row">
          <div class="col col-md-12 d-flex justify-content-between">
            <div class="col-md-3">
              <label class="my-1 mr-2" for="inlineFormCustomSelectPref">Số lượng:
              </label>
              <select class="custom-select my-1 mr-sm-2 col-md-5" id="inlineFormCustomSelectPref"
                (change)="onChangePageSize($event)">
                >
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
              </select>
            </div>
            <div class="">
              <nav aria-label="Page navigation example">
                <ul class="pagination">
                  <li class="page-item" [ngClass]="pagedResponseBinh?.pageNumber == 1 ? 'disabled' : ''">
                    <a class="page-link pointer" (click)="goToPage(pagedResponseBinh?.pageNumber - 1)">Previous</a>
                  </li>
                  <li class="page-item" *ngFor="let page of pagedResponseBinh?.pageNumberArr">
                    <a class="page-link pointer" [ngClass]="
                        pagedResponseBinh?.pageNumber == page ? 'active' : ''
                      " (click)="goToPage(page)">{{ page }}</a>
                  </li>
                  <li class="page-item" [ngClass]="
                      pagedResponseBinh?.pageNumber == pagedResponseBinh?.totalPages
                        ? 'disabled'
                        : ''
                    ">
                    <a class="page-link pointer" (click)="goToPage(pagedResponseBinh?.pageNumber + 1)">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<!-- Row ends -->


<!-- Modal Form Detail start -->
<div class="modal fade" id="formDetailButton" tabindex="-1" role="dialog" aria-labelledby="formDetail"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="formDetail">Thông tin phiếu giảm giá</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-chi-tiet-phieu [phieuDetails]="phieuDetails"></app-chi-tiet-phieu>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-rounded" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Form Detail ends -->