<app-main-heading
  [icon]="'fa-solid fa-shirt'"
  [mainHeading]="'Sản phẩm'"
  [title]="'Sản phẩm'"
></app-main-heading>

<div class="row gutters pt-2">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header">
        <h3 class="mb-4">Danh Sách Sản Phẩm '{{ sanPham?.ten }}'</h3>
        <!-- HEADER  -->
        <div>
          <div class="col col-md-12 d-flex">
            <div class="col-md-4"></div>
            <div class="col-md-4 text-left">
              <b class="form-label">Lọc theo giá bán</b>
              <div class="row mt-3">
                <!--  -->
                <span class="col-3"
                  >Giá thấp nhất:
                  <i
                    ><b>{{ formatCurrency(minPrice) }}</b></i
                  ></span
                >
                <span class="col-2">
                  {{ formatCurrency(minAndMaxPrice[0]) }}</span
                >
                <input
                  type="range"
                  class="form-range col-5"
                  id="customRange1"
                  style="display: inline-block"
                  [min]="minAndMaxPrice[0]"
                  [max]="changeableMaxPrice"
                  [value]="minPrice"
                  (input)="onMinPriceChange($event)"
                  [title]="'Min price: ' + formatCurrency(minPrice)"
                  step="1000"
                />
                <span class="col-2">{{
                  formatCurrency(changeableMaxPrice)
                }}</span>
              </div>

              <!--  -->
              <div class="row mt-3">
                <span class="col-3"
                  >Giá cao nhất:
                  <i
                    ><b>{{ formatCurrency(maxPrice) }}</b></i
                  ></span
                >
                <span class="col-2">
                  {{ formatCurrency(changeableMinPrice) }}</span
                >
                <input
                  type="range"
                  class="form-range col-5"
                  id="customRange1"
                  style="display: inline-block"
                  [min]="changeableMinPrice"
                  [max]="minAndMaxPrice[1]"
                  [value]="maxPrice"
                  (input)="onMaxPriceChange($event)"
                  [title]="'Max price: ' + formatCurrency(maxPrice)"
                  step="1000"
                />
                <span class="col-2">{{
                  formatCurrency(minAndMaxPrice[1])
                }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-3 mx-5">
          <b class="form-label">Lọc theo thuộc tính</b>
          <div class="col-3">
            <label class="form-label">Màu sắc</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'colorId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let ms of mauSacs" [value]="ms.id">
                {{ ms.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Kích cỡ</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'sizeId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let kc of kichCos" [value]="kc.id">
                {{ kc.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Kiểu dáng</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'formId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let kd of kieuDangs" [value]="kd.id">
                {{ kd.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Thiết kế</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'designId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let tk of thietKes" [value]="tk.id">
                {{ tk.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Kiểu tay áo</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'sleeveId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let ta of tayAos" [value]="ta.id">
                {{ ta.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Kiểu cổ áo</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'collarId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let ca of coAos" [value]="ca.id">
                {{ ca.ten }}
              </option>
            </select>
          </div>

          <div class="col-3">
            <label class="form-label">Chất liệu</label>
            <select
              class="form-select"
              (change)="onSelectField($event, 'materialId')"
            >
              <option value="0" selected>Tất cả</option>
              <option *ngFor="let cl of chatLieus" [value]="cl.id">
                {{ cl.ten }}
              </option>
            </select>
          </div>
        </div>
        <!--  -->
      </div>
      <div class="card-body" *ngIf="pagedResponse?.data.length > 0">
        <!-- TABLE -->
        <table class="table">
          <thead class="thead-default">
            <tr>
              <th>
                <input
                  id="ckBoxAll"
                  type="checkbox"
                  (click)="selectAllRows()"
                />
              </th>
              <th>STT</th>
              <th>Ảnh</th>
              <th width="10%">Màu Sắc</th>
              <th width="5%">Kích Cỡ</th>
              <th>Kiểu Dáng</th>
              <th>Thiết Kế</th>
              <th>Tay Áo</th>
              <th>Cổ Áo</th>
              <th>Chất Liệu</th>
              <th>Giá Nhập</th>
              <th>Giá Bán</th>
              <th>Số Lượng</th>
              <th>Trạng Thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody>
            <tr
              [id]="'row' + i"
              [ngClass]="
                checkSelectedRow('ckBoxForUpdate' + i) ? 'table-active' : ''
              "
              *ngFor="let s of pagedResponse?.data; let i = index"
            >
              <input [id]="'id' + i" type="hidden" [value]="s.id" />
              <td>
                <input
                  [id]="'ckBoxForUpdate' + i"
                  class="ckBoxForUpdate"
                  type="checkbox"
                  (change)="onCheckboxChange(i)"
                />
              </td>
              <th scope="row">
                {{
                  i +
                    1 +
                    (pagedResponse.pageNumber - 1) * pagedResponse.pageSize
                }}
              </th>
              <td>
                <div
                  id="carouselExampleSlidesOnly"
                  class="carousel slide"
                  data-bs-ride="carousel"
                  style="width: 60px"
                  data-bs-interval="3000"
                >
                  <div class="carousel-inner">
                    <div
                      class="carousel-item"
                      [class]="i === 1 ? 'active' : ''"
                      *ngFor="let img of s.hinhAnhs; let i = index"
                    >
                      <img [src]="img.imageUrl" class="d-block w-100 rounded" />
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <div>{{ s.mauSac.ten }}</div>
                <img
                  class="rounded"
                  [src]="s.mauSac.image.imageUrl"
                  style="width: 60px"
                />
              </td>
              <td>{{ s.kichCo.ten.split(" ")[0] }}</td>
              <td>{{ s.kieuDang.ten }}</td>
              <td>{{ s.thietKe.ten }}</td>
              <td>{{ s.tayAo.ten }}</td>
              <td>{{ s.coAo.ten }}</td>
              <td>{{ s.chatLieu.ten }}</td>
              <td>
                <span *ngIf="!checkSelectedRow('ckBoxForUpdate' + i)">{{
                  formatCurrency(s.giaNhap)
                }}</span>
                <div class="row" *ngIf="checkSelectedRow('ckBoxForUpdate' + i)">
                  <input
                    [id]="'giaNhap' + i"
                    class="col rounded"
                    type="text"
                    size="15"
                    [value]="s.giaNhap"
                    (input)="formatNumber2($event, 'giaNhap' + i)"
                  />
                  <span class="col">đ</span>
                </div>
              </td>

              <td>
                <span *ngIf="!checkSelectedRow('ckBoxForUpdate' + i)">{{
                  formatCurrency(s.giaBan)
                }}</span>
                <div class="row" *ngIf="checkSelectedRow('ckBoxForUpdate' + i)">
                  <input
                    [id]="'giaBan' + i"
                    class="col rounded"
                    type="text"
                    size="15"
                    [value]="s.giaBan"
                    (input)="formatNumber2($event, 'giaBan' + i)"
                  />
                  <span class="col">đ</span>
                </div>
              </td>

              <td>
                <span *ngIf="!checkSelectedRow('ckBoxForUpdate' + i)">{{
                  s.soLuongTon
                }}</span
                ><input
                  [id]="'soLuong' + i"
                  class="rounded"
                  *ngIf="checkSelectedRow('ckBoxForUpdate' + i)"
                  type="text"
                  size="5"
                  [value]="s.soLuongTon"
                  (input)="formatNumber2($event, 'soLuong' + i)"
                />
              </td>
              <td>
                <div class="custom-control custom-switch">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    [id]="'trangThai' + s.id"
                    [checked]="s.trangThai"
                    (click)="changeStatus(s.id)"
                  />
                  <label
                    class="custom-control-label"
                    [for]="'trangThai' + s.id"
                    >{{ s.trangThai ? "Đang bán" : "Ngừng bán" }}</label
                  >
                </div>
              </td>
              <td>
                <!-- <button
                  class="btn btn-outline-light btn-rounded me-2"
                  title="Xem chi tiết"
                  data-bs-toggle="modal"
                  data-bs-target="#sanPhamDetailsForm"
                >
                  <i
                    class="fa-solid fa-circle-info fa-xl"
                    style="color: #74c0fc"
                  ></i>
                </button> -->

                <button
                  class="btn btn-outline-warning btn-rounded me-2"
                  title="Cập nhật"
                  data-bs-toggle="modal"
                  data-bs-target="#sanPhamUpdateForm"
                >
                  <i
                    class="fa-solid fa-pen-to-square"
                    style="color: #ffd43b"
                  ></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <button
          class="btn btn-primary rounded my-3"
          *ngIf="isUpdateBtnHidden()"
          (click)="chinhSuaNhanh(pagedResponse?.pageSize)"
          data-bs-toggle="modal"
          data-bs-target="#updateModal"
        >
          <i class="fa-regular fa-pen-to-square me-2"></i>Cập nhật nhanh
        </button>
      </div>
      <div class="card-footer" *ngIf="pagedResponse?.data.length > 0">
        <div class="col col-md-12 d-flex justify-content-between">
          <div class="col-md-3">
            <label class="my-1 mr-2" for="inlineFormCustomSelectPref"
              >Số lượng:
            </label>
            <select
              class="custom-select my-1 mr-sm-2 col-md-5"
              id="inlineFormCustomSelectPref"
              (change)="onChangePageSize($event)"
            >
              >
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="">
            <nav aria-label="Page navigation example">
              <ul class="pagination">
                <li
                  class="page-item"
                  [ngClass]="pagedResponse?.pageNumber == 1 ? 'disabled' : ''"
                >
                  <a
                    class="page-link pointer"
                    (click)="goToPage(pagedResponse?.pageNumber - 1)"
                    >Previous</a
                  >
                </li>
                <li
                  class="page-item"
                  *ngFor="let page of pagedResponse?.pageNumberArr"
                >
                  <a
                    class="page-link pointer"
                    [ngClass]="
                      pagedResponse?.pageNumber == page ? 'active' : ''
                    "
                    (click)="goToPage(page)"
                    >{{ page }}</a
                  >
                </li>
                <li
                  class="page-item"
                  [ngClass]="
                    pagedResponse?.pageNumber == pagedResponse?.totalPages
                      ? 'disabled'
                      : ''
                  "
                >
                  <a
                    class="page-link pointer"
                    (click)="goToPage(pagedResponse?.pageNumber + 1)"
                    >Next</a
                  >
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
      <div class="text-center mt-3" *ngIf="pagedResponse?.data.length == 0">
        <h3>Không có dữ liệu!</h3>
      </div>
    </div>
  </div>
</div>

<app-overlay *ngIf="isLoadding" [text]="overlayText"></app-overlay>

<!-- <div class="input-group form-group search-block">
  <input
    type="search"
    class="form-control"
    placeholder="Tìm sản phẩm..."
    (search)="onClearSearchInput()"
    [(ngModel)]="search"
  />
  <input
    type="search"
    class="form-control"
    placeholder="Tìm sản phẩm..."
    (search)="onClearSearchInput()"
  />
  <span class="input-group-btn">
    <button class="btn btn-primary" type="button">Tìm kiếm</button>
    <button
      class="btn btn-primary"
      type="button"
      (click)="timKiem()"
    >
      Tìm kiếm
    </button>
  </span>
</div> -->
